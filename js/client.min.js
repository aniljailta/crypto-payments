"use strict";!function(){function t(t){return BXC_TRANSLATIONS&&t in BXC_TRANSLATIONS?BXC_TRANSLATIONS[t]:t}function e(t,e=-1){return T.loading(t,e)}function n(t,e={},n=!1){return T.ajax(t,e,n)}function i(t,e=!0){return T.activate(t,e)}function a(t){return t.closest(".bxc-main")}function o(t){for(var e=t.split("?").pop().split("&"),n={},i=0;i<e.length;i++){var a=e[i].split("=");n[a[0]]=a[1]}return n}function r(){c.on("click",".bxc-clipboard",function(){let e=v(this).find("span"),n=e.html();navigator.clipboard.writeText(window.atob(v(this).attr("data-text"))),e.html(t("Copied")),i(this),setTimeout(()=>{i(this,!1),e.html(n)},2e3)})}var c,s,l,d,u,p=!1,h="",f={},m={},x="undefined",b=typeof BXC_ADMIN!==x||document.getElementsByClassName("bxc-admin").length,g=document.getElementsByTagName("script"),y=typeof BXC_LANGUAGE!==x&&BXC_LANGUAGE,v=function(t){return"object"==typeof t&&"e"in t?t:new v.init("string"==typeof t?document.querySelectorAll(t):t)};v.init=function(t){this.e=void 0!==t[0]||NodeList.prototype.isPrototypeOf(t)?t:[t]},v.ajax=function(t,e=!1,n=!1,i="POST"){let a=new XMLHttpRequest,o="";e&&(o=new FormData).append("data",JSON.stringify(e)),a.open(i,t,!0),a.onload=(()=>{n&&n(a.responseText)}),a.onerror=(()=>!1),a.send(o)},v.extend=function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},v.documentHeight=function(){let t=document.body,e=document.documentElement;return Math.max(t.scrollHeight,t.offsetHeight,e.clientHeight,e.scrollHeight,e.offsetHeight)},v.init.prototype.on=function(t,e,n){for(var i=0;i<this.e.length;i++)this.e[i].addEventListener(t,function(t){for(var i=t.target;i&&i!==this;)i.matches(e)&&n.call(i,t),i=i.parentNode})},v.init.prototype.addClass=function(t){for(var e=0;e<this.e.length;e++)this.e[e].classList.add(t);return v(this.e)},v.init.prototype.removeClass=function(t){t=t.trim().split(" ");for(var e=0;e<t.length;e++)for(var n=0;n<this.e.length;n++)this.e[n].classList.remove(t[e]);return v(this.e)},v.init.prototype.toggleClass=function(t){for(var e=0;e<this.e.length;e++)this.e[e].classList.toggle(t);return v(this.e)},v.init.prototype.setClass=function(t,e=!0){for(var n=0;n<this.e.length;n++)e?v(this.e[n]).addClass(t):v(this.e[n]).removeClass(t);return v(this.e)},v.init.prototype.hasClass=function(t){return!!this.e.length&&this.e[0].classList.contains(t)},v.init.prototype.find=function(t){return 0===t.indexOf(">")&&(t=":scope"+t),!!this.e.length&&v(this.e[0].querySelectorAll(t))},v.init.prototype.parent=function(){return v(this.e[0].parentElement)},v.init.prototype.prev=function(){return v(this.e[0].previousElementSibling)},v.init.prototype.next=function(){return v(this.e[0].nextElementSibling)},v.init.prototype.attr=function(t,e=!1){return!1===e?this.e[0].getAttribute(t):(e?this.e[0].setAttribute(t,e):this.e[0].removeAttribute(t),v(this.e))},v.init.prototype.html=function(t=!1){return!1===t?this.e[0].innerHTML:("string"==typeof t?this.e[0].innerHTML=t:this.e[0].appendChild(t),v(this.e))},v.init.prototype.append=function(t){return this.e[0].innerHTML+=t,v(this.e)},v.init.prototype.prepend=function(t){return this.e[0].innerHTML=t+this.e[0].innerHTML,v(this.e)},v.init.prototype.replace=function(t){return this.e[0].outerHTML=t,v(this.e)},v.init.prototype.remove=function(){for(var t=0;t<this.e.length;t++)this.e[t].remove()},v.init.prototype.data=function(){let t={};for(var e=0,n=this.e[0].attributes,i=n.length;e<i;e++)t[n[e].nodeName.substr(5)]=n[e].nodeValue;return t},v.init.prototype.is=function(t){return!(1!=this.e[0].nodeType||!this.e.length)&&(t=t.toLowerCase(),this.e[0].tagName.toLowerCase()==t||v(this).attr("type")==t)},v.init.prototype.index=function(){return[].indexOf.call(this.e[0].parentElement.children,this.e[0])},v.init.prototype.siblings=function(){return this.e[0].parentNode.querySelectorAll(":scope > *")},v.init.prototype.length=function(){return this.e.length},v.init.prototype.val=function(t=null){if(null!==t)for(var e=0;e<this.e.length;e++)this.e[e].value=t;return this.e.length?this.e[0].value:""},v.load=function(t=!1,e=!0,n=!1,i=!1){let a=document.createElement(e?"script":"link");t?(e?a.src=t:a.href=t,a.type=e?"text/javascript":"text/css"):a.innerHTML=i,n&&(a.onload=function(){n()}),e||(a.rel="stylesheet"),document.head.appendChild(a)},window._query=v;var T={loading:function(t,e=-1){return t=v(t),-1!==e?t.setClass("bxc-loading",!0===e):!!t.hasClass("bxc-loading")||(this.loading(t,!0),!1)},activate:function(t,e=!0){return v(t).setClass("bxc-active",e)},ajax:function(t,e=!1,n=!1){e.function=t,e.language=y,v.ajax(BXC_URL+"ajax.php",e,t=>{let e=!1,i=!1;try{e=!((i=JSON.parse(t))&&"success"in i&&i.success)}catch(t){e=!0}e?(c.find(".bxc-loading").removeClass("bxc-loading"),console.error(t),m[u]=!1):n&&n(i.response)})},cookie:function(t,e=!1,n=!1,i="get",a=!1){let o="https:"==location.protocol?"SameSite=None;Secure;":"";if("get"==i){let e=document.cookie.split(";");for(var r=0;r<e.length;r++){for(var c=e[r];" "==c.charAt(0);)c=c.substring(1);if(0==c.indexOf(t)){let e=c.substring(t.length+1,c.length);return e||!1}}return!1}if("set"==i){let i=new Date;i.setTime(i.getTime()+n*(a?1:86400)*1e3),document.cookie=t+"="+e+";expires="+i.toUTCString()+";path=/;"+o}else this.cookie(t)&&(document.cookie=t+"="+e+";expires=Thu, 01 Jan 1970 00:00:01 GMT;path=/;"+o)},beautifyTime:function(e,n=!1,i=!1){let a;if("0000-00-00 00:00:00"==e)return"";if(e.indexOf("-")>0){let t=e.split(/[- :]/);a=new Date(t[0],t[1]-1,t[2],t[3],t[4],t[5])}else{let t=e.split(/[. :]/);a=new Date(t[2],t[1]-1,t[0],t[3],t[4],t[5])}let o=new Date(Date.UTC(a.getFullYear(),a.getMonth(),a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds())),r=Math.round((new Date-o)/864e5)*(i?-1:1),c=[t("Sunday"),t("Monday"),t("Tuesday"),t("Wednesday"),t("Thursday"),t("Friday"),t("Saturday")],s=o.toLocaleTimeString("en-EN",{hour:"2-digit",minute:"2-digit"});return"0"===s.charAt(0)&&(s.includes("PM")||s.includes("AM"))&&(s=s.substring(1)),r<1?`<span>${t("Today")}</span>${n?` <span>${s}</span>`:""}`:r<8?`<span>${c[o.getDay()]}</span>${n?` <span>${s}</span>`:""}`:`<span>${o.toLocaleDateString()}</span>${n?` <span>${s}</span>`:""}`},search:function(t,e){let n=v(t).parent().find("i"),i=v(t).val().toLowerCase().trim();n.hasClass("bxc-loading")||(i!=h?(clearTimeout(p),p=setTimeout(()=>{h=i,e(i,n),this.loading(n)},200)):this.loading(n,!1))},searchClear:function(t,e){v(t).next().val()&&(v(t).next().val(""),e())},getURL:function(t=!1,e=!1){if(e||(e=location.search),!t){for(var n=e.split("?").pop().split("&"),i={},a=0;a<n.length;a++){var o=n[a].split("=");i[o[0]]=SBF.escape(o[1])}return i}return e.indexOf("?")>0&&(e=e.substr(0,e.indexOf("?"))),T.escape(decodeURIComponent((new RegExp("[?|&]"+t+"=([^&;]+?)(&|#|;|$)").exec(e)||[,""])[1].replace(/\+/g,"%20")||""))},escape:function(t){return t?t.replaceAll("<script","&lt;script").replaceAll("</script","&lt;/script").replaceAll("javascript:","").replaceAll("onclick=","").replaceAll("onerror=",""):t},checkout:{settings:function(t){let e=(t=v(t)).attr("data-boxcoin"),n={checkout_id:e};return e.includes("custom")?v.extend(n,v(t).data()):n},init:function(t,e,n=!1){let i=this.storageTransaction(t.checkout_id);v.ajax(BXC_URL+"init.php",{checkout:t,language:y},t=>{if((e=v(e)).html(t),i){if(u=e.attr("data-boxcoin"),d=e.find("> .bxc-main"),i.encrypted)T.checkout.monitorTransaction(i.encrypted);else{let t=parseInt((Date.now()-i.storage_time)/1e3),e=BXC_SETTINGS.countdown-Math.floor(t/60),n=60-t%60;n&&e--,this.initTransaction(i.id,i.amount,i.address_payment,i.cryptocurrency,i.external_reference,[e,n],i.custom_token)}d.hasClass("bxc-popup")&&T.checkout.openPopup(u)}T.getURL("pay")&&e.find(`.bxc-payment-methods [data-cryptocurrency="${T.getURL("pay")}"]`).e[0].click(),n&&n(t)})},initTransaction:function(i,a,o,r,c,s=!1,p=!1){let h=d.find(".bxc-pay-cnt"),x=h.find(".bxc-pay-address"),b=r.toUpperCase(),g=h.find("[data-countdown]"),y={id:i,amount:a,address_payment:o,cryptocurrency:r,external_reference:c,custom_token:p},v=["usdt","usdc","link","shib"].includes(r)?" "+t("on ETH Network"):"";d.addClass("bxc-pay-cnt-active"),x.find(".bxc-text").html(b+v+" "+t("address")),x.find(".bxc-title").html(o),x.find(".bxc-clipboard").attr("data-text",window.btoa(o)),(x=h.find(".bxc-pay-amount")).find(".bxc-title").html(a+" "+b),x.find(".bxc-clipboard").attr("data-text",window.btoa(a)),d.attr("data-transaction-id",i),x=h.find(".bxc-qrcode-text"),h.find(".bxc-qrcode").attr("src",`https://api.qrserver.com/v1/create-qr-code/?size=500x500&data=${o}&color=${BXC_SETTINGS.qr_code_color}`),x.find("img").attr("src",p?p.img:`${BXC_URL}media/icon-${r}.svg`),x.find("div").html(t("Only send {T} to this address").replace("{T}",b+v)),g.html(""),l=s?[s[0],s[1],!0]:[BXC_SETTINGS.countdown,0,!0],clearInterval(f[u]),f[u]=setInterval(()=>{g.html(`${l[0]}:${l[1]<10?"0":""}${l[1]}`),l[1]--,l[1]<=0&&(l[0]<=0&&setTimeout(()=>{T.event("TransactionCancelled",y),this.cancelTransaction(),d.find("#bxc-expired-tx-id").html(i),d.removeClass("bxc-tx-cnt-active").addClass("bxc-failed-cnt-active")},500),l[0]<5&&l[2]&&(g.parent().addClass("bxc-countdown-expiring"),l[2]=!1),l[0]--,l[1]=59)},1e3),clearInterval(f["check-"+u]),f["check-"+u]=setInterval(()=>{m[u]||(m[u]=!0,n("check-transactions",{transaction_id:i},t=>{if(m[u]=!1,t){if("expired"==t)return;if(Array.isArray(t)&&"error"==t[0])return console.error(t[1]);this.monitorTransaction(t)}}))},3e3),this.storageTransaction(u,y),T.event("TransactionStarted",y),e(h,!1)},monitorTransaction:function(e){let i=this.storageTransaction(u),a="check-"+u;clearInterval(f[u]),clearInterval(f[a]),f[a]=setInterval(()=>{d&&!m[u]&&(m[u]=!0,n("check-transaction",{transaction:e},o=>{d.find(".bxc-tx-confirmations").html(o.confirmations+" / "+BXC_SETTINGS.confirmations),o.confirmations&&d.find(".bxc-tx-status").addClass("bxc-tx-status-confirmed").html(t("Confirmed")),o.confirmed&&(typeof BXC_WP_AJAX_URL!=x&&n(BXC_WP_AJAX_URL,{action:"bxc_wp_ajax",type:"woocommerce-payment-complete",transaction:i},t=>{document.location.href=t}),BXC_SETTINGS.webhook&&n("webhook",{transaction:e}),BXC_SETTINGS.redirect?setTimeout(()=>{document.location.href=encodeURI(`${BXC_SETTINGS.redirect}${BXC_SETTINGS.redirect.includes("?")?"&":"?"}transaction_id=${i.id}&amount=${i.amount}&address=${i.address}&cryptocurrency=${i.cryptocurrency}&external_reference=${i.external_reference}`)},1e3):d.removeClass("bxc-tx-cnt-active").addClass("bxc-complete-cnt-active"),clearInterval(f[a]),T.event("TransactionCompleted",i),this.cancelTransaction())}))},3e3),i&&(i.encrypted=e),u&&this.storageTransaction(u,i),d&&(d.addClass("bxc-tx-cnt-active"),d.find(".bxc-tx-status").removeClass("bxc-tx-status-confirmed").html(t("Pending")),d.find(".bxc-tx-confirmations").html("0 / "+BXC_SETTINGS.confirmations))},cancelTransaction:function(){clearInterval(f[u]),clearInterval(f["check-"+u]),d.removeClass("bxc-pay-cnt-active"),m[u]=!1,this.storageTransaction(u,"delete"),u=!1,d=!1},storageTransaction:function(t,e){let n=localStorage.getItem("bxc-active-transaction"),i=t in(n=n?JSON.parse(n):{});if(e)"delete"==e?delete n[t]:i&&!e.encrypted||(e.storage_time=Date.now(),n[t]=e);else if(i){if(n[t].encrypted||n[t].storage_time+6e4*BXC_SETTINGS.countdown>Date.now())return n[t];delete n[t]}return localStorage.setItem("bxc-active-transaction",JSON.stringify(n)),!1},show:function(t){c.find(`[data-boxcoin="${t}"] > div`).removeClass("bxc-hidden")},openPopup(t,e=!0){i(c.find(`[data-boxcoin="${t}"] `).find(".bxc-popup,.bxc-popup-overlay"),e)}},event:function(t,e={}){e.checkout_id=u;let n=new CustomEvent("BXC"+t,e);document.dispatchEvent(n)}};window.BOXCoin=T,document.addEventListener("DOMContentLoaded",()=>{if(c=v(document.body),b)r();else{if(typeof BXC_URL!=x)return;for(var l=0;l<g.length;l++)if(["boxcoin","boxcoin-js"].includes(g[l].id)){let p=g[l].src.replace("js/client.js","").replace("js/min/client.min.js",""),h=o(p);v.load(p+"css/client.css",!1),"lang"in h&&(y=h.lang),p.includes("?")&&(p=p.substr(0,p.indexOf("?"))),s=b?[]:c.find("[data-boxcoin]"),v.ajax(p+"init.php",{init:!0,language:y},t=>{v.load(!1,!0,!1,t),s.e.forEach(t=>{T.checkout.init(T.checkout.settings(t),t)})}),r(),T.event("Init"),c.on("click",".bxc-payment-methods > div",function(){let i=v(a(this)),o=i.parent().attr("data-boxcoin");if(i.find(".bxc-error").remove(),u&&o!=u)return i.find(".bxc-body").prepend(`<div class="bxc-error bxc-text">${t("Another transaction is being processed. Complete the transaction or cancel it to start a new one.")}</div>`),void setTimeout(()=>{i.find(".bxc-error").remove()},1e4);d=i,u=o;let r=v(this).attr("data-cryptocurrency"),c=d.attr("data-external-reference"),s=d.attr("data-price"),l=d.find("#user-amount"),p=v(this).attr("data-custom-coin");s&&-1!=s||(s=l.find("input").val())?(p&&(p={type:p,img:v(this).find("img").attr("src")}),d.addClass("bxc-pay-cnt-active"),e(d.find(".bxc-pay-cnt")),n("create-transaction",{amount:s,cryptocurrency_code:r,currency_code:d.attr("data-currency"),external_reference:d.attr("data-external-reference"),title:d.attr("data-title"),description:d.attr("data-description"),custom_token:p},t=>{T.checkout.initTransaction(t[0],t[1],t[2],r,c,!1,p)})):l.addClass("bxc-error")}),c.on("click",".bxc-back",function(){d.find(".bxc-pay-top-main").addClass("bxc-hidden")}),c.on("click","#bxc-abort-cancel, #bxc-confirm-cancel",function(){d.find(".bxc-pay-top-main").removeClass("bxc-hidden")}),c.on("click","#bxc-confirm-cancel",function(){T.event("TransactionCancelled",T.checkout.storageTransaction(u)),T.checkout.cancelTransaction()}),c.on("click",".bxc-failed-cnt .bxc-btn",function(){d.removeClass("bxc-failed-cnt-active")}),c.on("click",".bxc-btn-popup,.bxc-popup-close",function(){i(v(this.closest("[data-boxcoin]")).find(".bxc-popup,.bxc-popup-overlay"),v(this).hasClass("bxc-btn-popup"))});break}}},!1)}();